#!/bin/bash

set -e

if [[ -z ${USE_OS_TOOLS+x} ]]; then
	if [[ -d .git ]]; then
		echo "Prepairing git submodules"
		git submodule init
		git submodule update
	fi

	if ! [[ -d venv ]]; then
		echo "Creating python venv"
		python3 -m venv venv
	fi
	. venv/bin/activate
	pip install --disable-pip-version-check --quiet -r scripts/requirements.txt
fi

SCRIPTDIR="$( dirname -- "$0"; )";
SCONS_DEFAULT_FLAGS="-Q --warn=target-not-built"
python3 ${SCRIPTDIR}/lib/scons/scripts/scons.py ${SCONS_DEFAULT_FLAGS} "$@"
